-- =================================================================
-- СКРИПТ ЗАПОЛНЕНИЯ БАЗЫ ДАННЫХ "СКЛАДСКОЙ УЧЕТ"
-- Внимание: скрипт удалит все существующие данные в таблицах!
-- =================================================================

-- 1. Очистка таблиц в правильном порядке с сбросом счетчиков ID
TRUNCATE TABLE
    MaterialClasses,
    UnitsOfMeasure,
    DocumentTypes,
    Suppliers,
    MaterialGroups,
    Materials,
    WarehouseReceipts
RESTART IDENTITY CASCADE;

-- 2. Заполнение независимых справочников

-- Справочник: Классы материалов
INSERT INTO MaterialClasses (class_id, class_name) VALUES
(1, 'Строительные материалы'),
(2, 'Металлопрокат'),
(3, 'Электротовары'),
(4, 'Лакокрасочные материалы')
ON CONFLICT (class_id) DO NOTHING; -- Используем ON CONFLICT для безопасности при повторном запуске

-- Справочник: Единицы измерения
INSERT INTO UnitsOfMeasure (unit_id, unit_name, abbreviation) VALUES
(1, 'Штука', 'шт.'),
(2, 'Килограмм', 'кг'),
(3, 'Метр', 'м'),
(4, 'Литр', 'л'),
(5, 'Упаковка', 'упак.')
ON CONFLICT (unit_id) DO NOTHING;

-- Справочник: Типы сопроводительных документов
INSERT INTO DocumentTypes (doc_type_id, doc_type_name) VALUES
(1, 'Универсальный передаточный документ (УПД)'),
(2, 'Товарная накладная (ТОРГ-12)'),
(3, 'Счет-фактура')
ON CONFLICT (doc_type_id) DO NOTHING;

-- Справочник: Поставщики
INSERT INTO Suppliers (supplier_id, name, inn, legal_zip_code, legal_city, legal_street_address, bank_account) VALUES
(1, 'ООО "СтройКомплект"', '7701234567', '109004', 'г. Москва', 'ул. Земляной Вал, д. 50', '40702810100000001111'),
(2, 'АО "МеталлБаза №1"', '5032987654', '143005', 'г. Одинцово', 'ул. Транспортная, д. 2', '40702810500000002222'),
(3, 'ИП Петров Электромонтаж', '667012345678', '620014', 'г. Екатеринбург', 'пр. Ленина, д. 25', '40802810900000003333')
ON CONFLICT (supplier_id) DO NOTHING;

-- 3. Заполнение зависимых справочников

-- Справочник: Группы материалов (ссылается на MaterialClasses)
INSERT INTO MaterialGroups (group_id, group_name, class_id) VALUES
(1, 'Сухие смеси', 1),
(2, 'Крепеж', 1),
(3, 'Арматура', 2),
(4, 'Профильная труба', 2),
(5, 'Кабельная продукция', 3),
(6, 'Розетки и выключатели', 3),
(7, 'Эмали и грунтовки', 4)
ON CONFLICT (group_id) DO NOTHING;

-- Справочник: Материалы (ссылается на MaterialGroups)
INSERT INTO Materials (material_id, material_name, group_id) VALUES
(1, 'Цемент ПЦ-500 50кг', 1),
(2, 'Шпаклевка финишная Vetonit LR+ 25кг', 1),
(3, 'Саморез по дереву 3.5x55мм', 2),
(4, 'Арматура А500С 12мм', 3),
(5, 'Кабель ВВГ-Пнг(А)-LS 3x2.5', 5),
(6, 'Розетка двойная с/з белая "AtlasDesign"', 6),
(7, 'Грунтовка ГФ-021 серая 20кг', 7)
ON CONFLICT (material_id) DO NOTHING;

-- 4. Заполнение основной таблицы транзакций (Приходные ордера)
-- Эта таблица ссылается на все остальные справочники

INSERT INTO WarehouseReceipts (order_number, receipt_date, supplier_id, balance_account, doc_type_id, document_number, material_id, material_account, unit_id, quantity, unit_price) VALUES
-- Поступление №1 от "СтройКомплект": Цемент и шпаклевка
('П-101/24', '2024-05-20', 1, '10.01', 1, 'УПД-СК-5842', 1, '10.01.1', 1, 100, 450.00), -- 100 шт (мешков) цемента
('П-101/24', '2024-05-20', 1, '10.01', 1, 'УПД-СК-5842', 2, '10.01.1', 1, 50, 890.50),  -- 50 шт (мешков) шпаклевки

-- Поступление №2 от "МеталлБаза №1": Арматура
('П-102/24', '2024-05-21', 2, '10.03', 2, 'ТН-МБ-112', 4, '10.03.1', 3, 1500.5, 95.80), -- 1500.5 метров арматуры

-- Поступление №3 от "ИП Петров": Кабель и розетки
('П-103/24', '2024-05-22', 3, '10.05', 1, 'УПД-ИПП-45', 5, '10.05.2', 3, 300, 110.00), -- 300 метров кабеля
('П-103/24', '2024-05-22', 3, '10.05', 1, 'УПД-ИПП-45', 6, '10.05.3', 1, 40, 250.00),  -- 40 штук розеток

-- Поступление №4 от "СтройКомплект": Крепеж в упаковках
('П-104/24', '2024-05-23', 1, '10.01', 1, 'УПД-СК-5910', 3, '10.01.2', 5, 20, 1500.00); -- 20 упаковок саморезов
